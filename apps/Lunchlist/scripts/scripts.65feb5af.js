function X2JS(){function a(a){var b=a.localName;return null==b&&(b=a.baseName),(null==b||""==b)&&(b=a.nodeName),b}function b(a){return a.prefix}function c(a){return"string"==typeof a?a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"):a}function d(a){return a.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#x27;/g,"'").replace(/&#x2F;/g,"/")}function e(c){if(c.nodeType==r.DOCUMENT_NODE){var f=new Object,g=c.firstChild,h=a(g);return f[h]=e(g),f}if(c.nodeType==r.ELEMENT_NODE){var f=new Object;f.__cnt=0;for(var i=c.childNodes,j=0;j<i.length;j++){var g=i.item(j),h=a(g);if(f.__cnt++,null==f[h])f[h]=e(g),f[h+"_asArray"]=new Array(1),f[h+"_asArray"][0]=f[h];else{if(null!=f[h]&&!(f[h]instanceof Array)){var k=f[h];f[h]=new Array,f[h][0]=k,f[h+"_asArray"]=f[h]}for(var l=0;null!=f[h][l];)l++;f[h][l]=e(g)}}for(var m=0;m<c.attributes.length;m++){var n=c.attributes.item(m);f.__cnt++,f["_"+n.name]=n.value}var o=b(c);return null!=o&&""!=o&&(f.__cnt++,f.__prefix=o),1==f.__cnt&&null!=f["#text"]&&(f=f["#text"]),null!=f["#text"]&&(f.__text=f["#text"],q&&(f.__text=d(f.__text)),delete f["#text"],delete f["#text_asArray"]),null!=f["#cdata-section"]&&(f.__cdata=f["#cdata-section"],delete f["#cdata-section"],delete f["#cdata-section_asArray"]),(null!=f.__text||null!=f.__cdata)&&(f.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),f}return c.nodeType==r.TEXT_NODE||c.nodeType==r.CDATA_SECTION_NODE?c.nodeValue:void 0}function f(a,b,c,d){var e="<"+(null!=a&&null!=a.__prefix?a.__prefix+":":"")+b;if(null!=c)for(var f=0;f<c.length;f++){var g=c[f],h=a[g];e+=" "+g.substr(1)+"='"+h+"'"}return e+=d?"/>":">"}function g(a,b){return"</"+(null!=a.__prefix?a.__prefix+":":"")+b+">"}function h(a,b){return-1!==a.indexOf(b,a.length-b.length)}function i(a,b){return h(b.toString(),"_asArray")||0==b.toString().indexOf("_")||a[b]instanceof Function?!0:!1}function j(a){var b=0;if(a instanceof Object)for(var c in a)i(a,c)||b++;return b}function k(a){var b=[];if(a instanceof Object)for(var c in a)-1==c.toString().indexOf("__")&&0==c.toString().indexOf("_")&&b.push(c);return b}function l(a){var b="";return null!=a.__cdata&&(b+="<![CDATA["+a.__cdata+"]]>"),null!=a.__text&&(b+=q?c(a.__text):a.__text),b}function m(a){var b="";return a instanceof Object?b+=l(a):null!=a&&(b+=q?c(a):a),b}function n(a,b,c){var d="";if(0==a.length)d+=f(a,b,c,!0);else for(var e=0;e<a.length;e++)d+=f(a[e],b,k(a[e]),!1),d+=o(a[e]),d+=g(a[e],b);return d}function o(a){var b="",c=j(a);if(c>0)for(var d in a)if(!i(a,d)){var e=a[d],h=k(e);if(null==e||void 0==e)b+=f(e,d,h,!0);else if(e instanceof Object)if(e instanceof Array)b+=n(e,d,h);else{var l=j(e);l>0||null!=e.__text||null!=e.__cdata?(b+=f(e,d,h,!1),b+=o(e),b+=g(e,d)):b+=f(e,d,h,!0)}else b+=f(e,d,h,!1),b+=m(e),b+=g(e,d)}return b+=m(a)}var p="1.0.11",q=!1,r={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,DOCUMENT_NODE:9};this.parseXmlString=function(a){var b;if(window.DOMParser){var c=new window.DOMParser;b=c.parseFromString(a,"text/xml")}else 0==a.indexOf("<?")&&(a=a.substr(a.indexOf("?>")+2)),b=new ActiveXObject("Microsoft.XMLDOM"),b.async="false",b.loadXML(a);return b},this.xml2json=function(a){return e(a)},this.xml_str2json=function(a){var b=this.parseXmlString(a);return this.xml2json(b)},this.json2xml_str=function(a){return o(a)},this.json2xml=function(a){var b=this.json2xml_str(a);return this.parseXmlString(b)},this.getVersion=function(){return p},this.escapeMode=function(a){q=a}}var x2js=new X2JS;angular.module("futudashApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl"}).when("/settings",{templateUrl:"views/settings.html",controller:"SettingsCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("futudashApp").controller("MainCtrl",["$scope","$interval","$http","Weather","Settings",function(a,b,c,d,e){a.currentDate=moment().format("dddd, MMM D")}]);var RESTAURANT_LIMIT=9,APPROVED_RESTAURANTS=["/ravintola-tampella","/sodexo-tampereen-oikeustalo","/trattoria","/valssi","/speakeasy-finlayson-ylkerta","/fabric","/juvenes-frenckell","/the-grill","/ohranjyva"];angular.module("futudashApp").controller("FoodCtrl",["$scope","$sce","Food","$interval",function(a,b,c,d){a.foodLoading=!0;var e=36e5,f=function(){c.get().then(function(c){var d=document.createElement("div");d.innerHTML=c;var e=d.getElementsByClassName("menu"),f=[].slice.call(e);f=_.filter(f,function(a){return _.findIndex(APPROVED_RESTAURANTS,function(b){return a.innerHTML.indexOf(b)>=0})>=0}),f=f.slice(0,RESTAURANT_LIMIT);var g=_.map(f,function(a){return a.outerHTML||""}).join("");a.foodData=b.trustAsHtml(g),a.foodLoading=!1},function(b){console.log("No food data for you",b),a.foodLoading=!1})};d(f,e),f()}]),angular.module("futudashApp").controller("MovieCtrl",["$scope","$sce","Movies","Settings",function(a,b,c,d){a.title=d.get().finnkinoName,a.movies="Loading movies...",c.get(d.get().finnkinoArea).then(function(b){var c=x2js.xml_str2json(b);a.movies=_.groupBy(c.Schedule.Shows_asArray[0].Show_asArray,function(a){return a.Title}),a.movies=_.filter(a.movies,function(b){return a.filterStartedMovies(b)})});var e=moment();a.filterStartedShows=function(a){return moment(a.dttmShowStart).isAfter(e)},a.filterStartedMovies=function(b){return _.filter(b,function(b){return a.filterStartedShows(b)}).length},a.getTime=function(a){return moment(a).format("HH:mm")}}]),angular.module("futudashApp").controller("ClockCtrl",["$scope","$interval",function(a,b){var c=function(){a.date=new Date};b(c,3e4),c()}]).controller("AnalogClockCtrl",["$scope","$interval",function(a,b){var c=1e3;a.analog={};var d=function(b,c){a.analog[b]=c},e=function(){var b=moment();a.hours=b.hours(),a.minutes=b.minutes()<10?"0"+b.minutes():b.minutes(),a.seconds=b.seconds()<10?"0"+b.seconds():b.seconds(),d("sec",6*b.seconds()),d("min",6*b.minutes()),d("hour",30*(b.hours()%12)+b.minutes()/2)};e();var f=b(function(){e()},c);a.$on("$destroy",function(){b.cancel(f)})}]),angular.module("futudashApp").controller("BlogCtrl",["$scope","$interval","Settings","FeedService",function(a,b,c,d){var e=1,f=1;a.loadFeed=function(c){d.parseFeed(c,e).then(function(c){a.feeds=c.data.responseData.feed.entries,console.log(a.feeds),a.feeds.map(function(a){return a.publishedDate=a.publishedDate?moment(a.publishedDate).format("DD.MM.YYYY"):moment().format("DD.MM.YYYY"),a}),a.showFeed=0,a.feed=a.feeds[a.showFeed],b(function(){a.showFeed=a.showFeed>=a.feeds.length-1?0:a.showFeed+1,a.feed=a.feeds[a.showFeed]},6e4*f)})},a.loadFeed(c.get().rss)}]),angular.module("futudashApp").controller("WeatherCtrl",["$scope","$interval","Weather",function(a,b,c){a.icons={"01d":"ion-ios7-sunny-outline","02d":"ion-ios7-partlysunny-outline","03d":"ion-ios7-cloudy-outline","04d":"ion-ios7-cloud-outline","09d":"ion-ios7-rainy-outline","10d":"ion-ios7-rainy-outline","11d":"ion-ios7-thunderstorm-outline","13d":"ion-ios7-snowy","50d":"ion-ios7-cloudy-outline","01n":"ion-ios7-moon-outline","02n":"ion-ios7-cloudy-night-outline","03n":"ion-ios7-cloudy-outline","04n":"ion-ios7-cloudy-outline","09n":"ion-ios7-rainy-outline","10n":"ion-ios7-rainy-outline","13n":"ion-ios7-thunderstorm-outline","11n":"ion-ios7-snowy","50n":"ion-ios7-cloudy-outline"},a.weather={};var d=function(b){c.get().then(function(c){a.weather=c,a.weather.main.temp=Math.round(10*a.weather.main.temp)/10,e(b)},function(a){console.log("No weather info for you")})},e=function(b){var c={segmentShowStroke:!0,segmentStrokeColor:"#fff",segmentStrokeWidth:1,percentageInnerCutout:90,animationSteps:100,animationEasing:"easeOutBounce",animateRotate:b,animateScale:!1,responsive:!0,maintainAspectRatio:!1},d=a.weather.main.temp,e=d>0?[{value:d,color:"rgba(255,255,255,1)"},{value:30-parseFloat(d),color:"transparent"}]:[{value:30+parseFloat(d),color:"#77D4CB",highlight:"transparent"},{value:-d,color:"rgba(255,255,255,1)"}];if(document.getElementById("temperature")){var f=document.getElementById("temperature").getContext("2d");new Chart(f).Doughnut(e,c)}};d(!0),b(function(){d(!1)},6e5)}]),angular.module("futudashApp").controller("FlowCtrl",["$scope","$interval","Flow","Settings",function(a,b,c,d){a.title=d.get().name;var e=7,f=3,g=function(a){var b,c=[],d=new Date,e=new Date(d.setHours(d.getHours()+1)).getHours();for(b=0;a>b;b++)0>e&&(e=23),c.push(e--);return c.reverse()},h=function(a){var b,c=[],d=new Date,e=moment(d).add(1,"h");for(b=0;a>b;b++)c.push(moment(e).subtract(b,"h").format("DD.MM.YYYY HH"));return c.reverse()},i={scaleShowGridLines:!1,scaleFontFamily:"Montserrat",scaleFontSize:20,scaleFontStyle:"900",scaleFontColor:"rgba(0,0,0,.25)",scaleOverride:!0,scaleSteps:6,scaleStepWidth:5,scaleStartValue:0,showScale:!0,scaleGridLineColor:"rgba(0,0,0,.0)",scaleGridLineWidth:0,scaleIntegersOnly:!0,bezierCurve:!0,bezierCurveTension:.4,pointDot:!0,pointDotRadius:4,pointDotStrokeWidth:1,pointHitDetectionRadius:20,datasetStroke:!0,datasetStrokeWidth:2,datasetFill:!0,showTooltips:!1,responsive:!0};a.flows=d.get().flows;var j=_.map(a.flows,function(a,b){return{label:a.label,fillColor:a.fill,strokeColor:"transparent",pointColor:"transparent",pointStrokeColor:"transparent",pointHighlightFill:"transparent",pointHighlightStroke:"transparent",data:new Array(e+1).join("0").split("").map(parseFloat)}});a.ctx=document.getElementById("flowChart").getContext("2d"),a.flowChartdata={labels:g(e),datasets:j},a.flowLineChart=new Chart(a.ctx).Line(a.flowChartdata,i),a.getFlows=function(b){_.each(a.flows,function(d,f){c.get(d.name,100).then(function(c){a.tredata=[];for(var d=h(e),j=0;j<d.length;j++)void 0!=c[d[j]]?a.tredata.push(c[d[j]]):a.tredata.push(0);a.flowChartdata.labels=g(e),a.flowChartdata.datasets[f].data=a.tredata,b&&(i.animation=!1),f>=a.flows.length-1&&(a.flowLineChart=new Chart(a.ctx).Line(a.flowChartdata,i))})})},a.getFlows(!1),b(function(){a.getFlows(!0)},6e4*f)}]),angular.module("futudashApp").controller("TrendCtrl",["$scope","$interval","CustomJSON","Settings",function(a,b,c,d){a.settings=d.get()}]),angular.module("futudashApp").controller("CountdownCtrl",["$scope","$interval","Settings",function(a,b,c){var d=(new Date,function(){var b=new Date,c=(b.getSeconds(),b.getMinutes());b.getHours();a.minutes.animate(c/60,function(){}),a.clock=moment(new Date).format("HH:mm"),a.date=b});b(d,1e3),d()}]),angular.module("futudashApp").controller("StaticImgCtrl",["$scope","Settings",function(a,b){a.imgUrl=b.get().staticImgUrl}]),angular.module("futudashApp").controller("SettingsCtrl",["$scope","$timeout","$location","Settings",function(a,b,c,d){var e=function(){var a=d.get().color.main||"#555";document.body.style.backgroundColor=a,document.body.className=document.body.className.replace("fixed","")};e(),a.settings=d.get(),a.$watch("settings",function(a){console.log(a)}),a.save=function(){d.set(a.settings),a.settings=d.get(),b(function(){c.path("#/")},300)},a.restore=function(){d.set(null),a.settings=d.get()},a.isObjectOrArray=function(a){return _.isObject(a)||_.isArray(a)}}]),angular.module("futudashApp").value("corsURL","//cors-anywhere.herokuapp.com/").factory("Food",["$http","$q","Settings","corsURL",function(a,b,c,d){return{get:function(){var e=(new Date).getDay();e||(e=7);var f=d+"http://lounaat.info/ajax/filter?view=lahistolla&page=0",g=b.defer();return a.get(f,{params:{day:e,"coords[address]":c.address,"coords[lat]":c.get().coords.lat,"coords[lng]":c.get().coords.lng}}).success(function(a){g.resolve(a)}).error(function(a){g.reject(a)}),g.promise}}}]).factory("Movies",["$http","$q","Settings",function(a,b){return{get:function(c){var d=b.defer();return a.get("//www.finnkino.fi/xml/Schedule",{params:{area:c,dt:moment(new Date).format("DD.MM.YYYY")}}).success(function(a){d.resolve(a)}),d.promise}}}]).factory("FeedService",["$http",function(a){return{parseFeed:function(b,c){return a.jsonp("//ajax.googleapis.com/ajax/services/feed/load?v=1.0&num="+c+"&callback=JSON_CALLBACK&q="+encodeURIComponent(b))}}}]).factory("Weather",["$http","$q","corsURL","Settings",function(a,b,c,d){return{get:function(){var e=b.defer();return a.get(c+"http://api.openweathermap.org/data/2.5/weather",{params:{APPID:"488e49ee1ce983be59e69292af6c9dd4",units:"metric",lat:d.get().coords.lat,lon:d.get().coords.lng}}).success(function(a,b,c,d){e.resolve(a)}),e.promise}}}]).factory("Flow",["$http","$q","corsURL",function(a,b,c){return{get:function(d,e){var f=b.defer();return a.get(c+"base.vv.si/api/flow/",{params:{flow:d,limit:e}}).success(function(a,b,c,d){f.resolve(a)}),f.promise}}}]).factory("CustomJSON",["$http","$q","corsURL",function(a,b,c){return{get:function(d,e){var f=b.defer();return a.get(c+d,{params:e}).success(function(a,b,c,d){f.resolve(a)}),f.promise}}}]),angular.module("futudashApp").factory("Settings",function(){return{get:function(){var a=_.defaults(JSON.parse(localStorage.getItem("futudash"))||{},{name:"Tampere",logourl:"http://static.flockler.com/assets/futurice/images/futurice-logo--white.svg",staticImgUrl:"https://images.unsplash.com/photo-1464306076886-da185f6a9d05?dpr=1&auto=format&fit=crop&w=1199&h=799&q=80&cs=tinysrgb&crop=",coords:{lat:61.5023026,lng:23.763800500000002},address:"kuninkaankatu-21-tampere",finnkinoArea:1035,finnkinoName:"Plevna",rss:"http://futurice.com/blog/rss",color:{main:"#ffffff",dark:"#6BBEB6",light:"#BBEAE5"},flows:[{name:"tampere",label:"Tampere",fill:"rgba(255,255,255,0.3)"},{name:"tampere-offtopic-friday",label:"Tampere Offtopic",fill:"rgba(0,0,0,0.15)"}]});return a},set:function(a){localStorage.setItem("futudash",JSON.stringify(a))}}});